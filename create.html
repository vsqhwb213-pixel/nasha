<script>
    // Проверка "мозгов" сайта перед началом
    const currentUser = localStorage.getItem('nasha_user');

    if (!currentUser) {
        alert("Ошибка: Пожалуйста, войдите в аккаунт!");
        window.location.href = 'login.html';
    }

    // Когда видео загрузится на сервер Cloudinary (вставь это в onload)
    xhr.onload = () => {
        const res = JSON.parse(xhr.responseText);
        if (res.secure_url) {
            // Сохраняем видео именно под этим пользователем
            const videoData = {
                url: res.secure_url,
                author: currentUser, // Тот самый "запомненный" юзер
                date: new Date().toLocaleDateString()
            };
            
            // Сохраняем в общий список проектов
            let allVideos = JSON.parse(localStorage.getItem('nasha_projects') || '[]');
            allVideos.push(videoData);
            localStorage.setItem('nasha_projects', JSON.stringify(allVideos));

            alert(currentUser + ", твой проект сохранен!");
            window.location.href = 'index.html';
        }
    };
</script>
